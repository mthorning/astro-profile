<style>
  #cw {
    position: fixed;
    z-index: -1;
  }

  body {
    margin: 0;
    padding: 0;
    background-color: rgba(0, 0, 0, 0.05);
  }
</style>

<script>
  const canvas = document.getElementById("cw") as HTMLCanvasElement
  const context = canvas.getContext("2d");

  if(!context) throw new Error("No context");

  context.globalAlpha = 0.5;

  const cursor = {
    x: innerWidth / 2,
    y: innerHeight / 2,
  };

  class Particle {
    x: number;
    y: number;
    particleTrailWidth: number;
    strokeColor: string;
    rotateSpeed: number;
    theta: number;
    t: number;

    constructor(
      x: number,
      y: number,
      particleTrailWidth: number,
      strokeColor: string,
      rotateSpeed: number,
    ) {
      this.x = x;
      this.y = y;
      this.particleTrailWidth = particleTrailWidth;
      this.strokeColor = strokeColor;
      this.theta = Math.random() * Math.PI * 0.1;
      this.rotateSpeed = rotateSpeed;
      this.t = Math.random() * 500;
    }

    rotate() {
      if(!context) throw new Error("No context");
      const ls = {
        x: this.x,
        y: this.y,
      };
      this.theta += this.rotateSpeed;
      this.x = cursor.x + Math.cos(this.theta) * this.t;
      this.y = cursor.y + Math.sin(this.theta) * this.t;
      context.beginPath();
      context.lineWidth = this.particleTrailWidth;
      context.strokeStyle = this.strokeColor;
      context.moveTo(ls.x, ls.y);
      context.lineTo(this.x, this.y);
      context.stroke();
    }
  }

  let particlesArray: InstanceType<typeof Particle>[] = [];

  generateParticles(50);
  setSize();
  animate();

  /* addEventListener("mousemove", (e) => {
  cursor.x = e.clientX;
  cursor.y = e.clientY;
}); */

  /* addEventListener(
  "touchmove",
  (e) => {
    e.preventDefault();
    cursor.x = e.touches[0].clientX;
    cursor.y = e.touches[0].clientY;
  },
  { passive: false },
); */

  addEventListener("resize", () => setSize());

  function generateParticles(amount: number) {
    for (let i = 0; i < amount; i++) {
      particlesArray[i] = new Particle(
        innerWidth / 2,
        innerHeight / 2,
        4,
        generateColor(),
        0.02,
      );
    }
  }

  function generateColor() {
    let hexSet = "0123456789ABCDEF";
    let finalHexString = "#";
    for (let i = 0; i < 6; i++) {
      finalHexString += hexSet[Math.ceil(Math.random() * 15)];
    }
    return finalHexString;
  }

  function setSize() {
    canvas.height = innerHeight;
    canvas.width = innerWidth;
  }


  function animate() {
    if(!context) throw new Error("No context");
    requestAnimationFrame(animate);

    context.fillStyle = "rgba(0,0,0,0.05)";
    context.fillRect(0, 0, canvas.width, canvas.height);

    particlesArray.forEach((particle) => particle.rotate());
  }

</script>

<canvas id="cw"></canvas>
